# Журнал изменений проекта (GrandTransfer)

Этот файл вести для того, чтобы отслеживать все изменения, внесенные в проект с помощью ИИ, и легко синхронизировать работу на разных устройствах.

## Последние крупные обновления (Февраль 2026)

### 1. Премиальный дизайн (Hero & Typography)
*   **Типографика:** Перешли на шрифтовую пару `Cormorant` (заголовки) и `Montserrat` (текст).
*   **Hero (Главный экран):** Заголовки разделены на 3 строки для лучшего управления стилями и создания воздушности. Адаптированы под мобильные устройства (уменьшение размера шрифта на экранах <768px и <480px).
*   **Кнопки:** Стиль кнопок приведен к единому виду (темный фон, статусная форма pill-shape, золотая обводка и эффект свечения `box-shadow` при наведении).

### 2. Шапка (Header)
*   **Респонсивность (Адаптация):** Доработаны медиа-запросы.
    *   `< 1150px`: Скрывается текст логотипа (остается иконка), чтобы сэкономить место.
    *   `< 900px`: Меню навигации заменяется на "бургер".
    *   `< 768px`: Кнопка телефона (круглая иконка) оставлена видимой, при нехватке места скрываются иконки соцсетей.
*   **Кнопка вызова:** Превращена в аккуратную круглую кнопку, по стилю (размерам и паддингам) совпадающую с кнопками социальных сетей.

### 3. Исправление геолокации и выбора города (`CityContext.tsx`)
*   **Отвязка от вечного кэша:** Логика хранения выбранного города изменена с `localStorage` на `sessionStorage`. Теперь при старте новой сессии с другого места сайт выполнит поиск по IP через `geojs` и обновит город.
*   **Сортировка городов:** В выпадающем списке текущий выбранный город всегда отображается _первым_ (на нулевом индексе), а остальные следуют под ним.

### 4. Очистка кода и багфиксы
*   **Popular Routes:** Убрана приписка расчета "Эконом • 29 ₽/км" (теперь показывается только цена "от 4000 ₽").
*   **Опечатки:** Исправлен регистр "ДНр" на "ДНР" во всех списках.
*   **Изображения:** Стандартный `next/image` (`<Image>`) заменен на обычный HTML-тег `<img>` во многих карточках (например, в тарифах и маршрутах), в связи с проблемами таймаутов на внешних доменах.
*   **SEO:** В `robots.txt` добавлены базовые правила индексации.
*   **Архитектура:** Создана директория `/scripts/`, куда перемещены все служебные Node.js скрипты (вроде автозаполнения координат городов), добавлены скрипты `preview.bat` и `check_site.bat` для быстрого запуска и проверок.

### 5. Интеграция Telegram-бота и Базы Данных (Prisma + SQLite)
*   **База данных:** Подключена ORM `Prisma` на базе легковесной базы `SQLite` (`dev.db`), которая теперь сохраняет все заявки, цены, имена и телефоны локально на сервере.
*   **Уведомления:** Создан скрипт `scripts/bot.ts` и `telegram.ts`. При отправке формы `BookingForm` данные летят на новый API-роут `/api/order/route.ts`, который тут же пересылает сообщение владельцу в Telegram.
*   **Статистика бота:** Внедрена команда `/stats` для подсчета выполненных заказов и выручки, а также защищенная команда `/reset` для обнуления базы.

### 6. Улучшение формы заказа (BookingForm)
*   **UX/UI:** Заменен ползунок пассажиров на удобные кликабельные кнопки (1-8). Добавлено поле для текстовых комментариев к заказу.
*   **Автоопределение города:** Внедрен хук `useGeolocationCity`, который при открытии сайта ищет IP клиента через `ip-api.com` и автоматически выставляет город в секции "Откуда" (по умолчанию Ижевск при неудаче).
*   **Состояния отправки:** Во время запроса к кнопке добавляется лоадер-крутилка. При успехе форма плавно заменяется на красивый блок с галочкой и кнопкой по центру (Сделать новый заказ).

### 7. Юридические документы и Ссылки
*   **GDPR:** Создана новая системная страница `/privacy` с "Политикой конфиденциальности". Ссылка на неё выведена в подвал для соблюдения ФЗ-152.
*   **Соцсети:** Заменены ссылки-заглушки в подвале на актуальные профили пользователя (Telegram, WhatsApp, VK).

### 8. Отзывы (Reviews)
*   **Карусель:** Отключен жесткий `scroll-snap` в CSS. Внедрен умный скроллинг по расчету ширины карточки в пикселях. Добавлены кнопки "Влево-Вправо" для листания отзывов.

### 9. Оптимизация ассетов и Авторство
*   **Изображения:** Все картинки автомобилей и логотипы конвертированы из `png/jpg` в современный `webp` для сверхбыстрой загрузки.
*   **Удаление неиспользуемого:** Полностью удалена папка `public/images/cities` и свойство `heroImage` из массива городов (`src/data/cities.ts`), так как от фотографий городов решено отказаться ради чистоты премиального дизайна.
*   **Favicon:** Заменена стандартная иконка Next.js на кастомный золотой SVG-логотип вкладок.
*   **Footer:** В подвал сайта добавлено указание авторства разработки ("Ившин М.С") с активной ссылкой на Telegram автора.

### 10. Деплой на Vercel и SEO-оптимизация
*   **Vercel Build:** Устранены ошибки кэширования статики `Next.js` при работе с `Prisma` на серверах Vercel. Добавлен скрипт `postinstall: prisma generate` для корректной сборки клиента локальной БД в облаке, а API-эндпоинт заказа переведен в режим `force-dynamic`.
*   **Ошибки TypeScript:** Очищены конфликты версий (удален `prisma.config.ts` и отключен `eslint` в `next.config.ts`), типизирован `telegram.ts` для прохождения строгих линтеров.
*   **Телеграм Маршруты:** В уведомления бота добавлена единая кликабельная ссылка на **комбинированный маршрут** в Яндекс Картах (через параметр `~rtext`), чтобы водитель мог открыть навигатор в один клик.
*   **Индексация SEO:** Добавлены автоматические файлы `/sitemap.xml` и `/robots.txt` для корректной индексации сайта в поисковиках (Google, Yandex). Устранена проблема с кодировкой UTF-16 от Windows PowerShell, файлы пересозданы в `UTF-8`.
*   **Шапка (Header):** На логотип добавлено событие `onClick` для плавного возврата (`smooth scroll`) в самое начало страницы, если пользователь уже находится на Главной.
### 11. Фиксы UI, Геолокации и Тарифов
*   **Отзывы (Reviews):** Заголовок и подзаголовок секции выровнены строго по центру экрана.
*   **Геолокация:** Доработка логики `CityContext.tsx`. Полностью убрано сохранение города в `sessionStorage`. Теперь при каждом новом открытии сайта (заходе с устройства) система всегда приоритетно получает реальную геолокацию пользователя (исправлен баг "залипания" вручную выбранного города).
*   **Калькулятор (Подача):** Убрана базовая фиксированная стоимость "Подачи машины" в 500 рублей изо всех маршрутов (доставка по-прежнему считается от 1500 рублей).
*   **Новый Тариф:** Добавлен новый тариф "Комфорт", который занимает место между "Стандарт" и "Комфорт+". Он добавлен в базу городов, в калькулятор и в карточки тарифов на главной странице.

---
_Добавляйте записи в этот файл при выполнении новых крупных задач, чтобы не терять контекст!_
